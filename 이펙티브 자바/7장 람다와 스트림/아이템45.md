# 스트림은 주의해서 사용하라
## 스트림이란
- 다량의 데이터 처리 작업을 돕고자 자바 8에 추가되었다.
- 컬렉션, 배열 등에 저장된 요소들을 하나씩 참조하면서 코드를 실행할 수 있다. 
- 불필요한 for문을 없애고, 람다식을 활용할 수 있어 코드를 직관적이게 처리할 수 있다
## 스트림의 특징
- 스트림은 데이터 소스를 변경하지 않는다.
- 스트림은 일회용이다.
- 스트림은 작업을 내부 반복으로 처리한다.
- 스트림은 중간 연산과 최종 연산으로 구분된다.
- 스트림은 병렬 처리가 가능하다.
## 스트림 파이프 라인
스트림 파이프 라인은 소스 스트림에서 시작하여 종단 연산으로 끝나며, 그 사이에 하나 이상의 중간 연산이 있을 수 있따. 
### 중간 연산(중개 연산)
중간 연ㅅ나은 다른 스트림을 반환하도록 스트림을 리턴한다. 중간 연산은 지연 연산으로 처리되며, 최종 연산이 호출되어야 실행된다.
- 예) filter, map, limit, sorted, distinct, peek, skip, parallel, sequential, unordered
### 최종 연산(종단 연산)
최종 연산은 스트림 파이프 라인에서 결과를 도출한다. 최종 연산이 호출되어야 중간 연산이 실행된다. 더 이상의 연산을 추가할 수 없다.
- 예) forEach, forEachOrdered, toArray, reduce, collect, min, max, count, anyMatch, allMatch, noneMatch, findFirst, findAny, iterator
### 스트림의 지연 평가
스트림에 대한 평가는 종단 연산이 호출될 때 이뤄지며, 종단 연산에 쓰이지 않는 데이터 원소는 계산에 쓰이지 않는다. 이러한 지연 평가가 무한 스트림을 다룰 수 있게 해주는 것이다. 
따라서 **종단 연산이 없는 스트림 파이프라인은 아무 일도 일어나지 않는다**
## 스트림을 사용할 때 주의할 점
스트림을 과도하게 쓰게 된다면 프로그램이 읽거나 유지 보수하기가 어려워진다.
~~~java
//과도한 스트림
words.collect(
    groupingBy(word -> word.chars().sorted()
        .collect(StringBuilder::new, (sb, c) -> sb.append((char) c), StringBuilder::append).toString()
    ).values().stream()
    .filter(group -> group.size() >= minGroupSize)
    .map(group -> group.size() + ": " + group)
    .forEach(System.out::println);
);
~~~
위의 코드는 스트림을 과도하게 사용한 예이다. 이 코드는 스트림을 과도하게 사용하지 않고도 더 간결하게 작성할 수 있다.
~~~java
//스트림을 과도하게 사용하지 않은 예
words.collect(groupingBy(word -> alphabetize(word)))
    .values().stream()
    .filter(group -> group.size() >= minGroupSize)
    .forEach(g -> System.out.println(g.size() + ": " + g));
~~~
따라서 스트림을 적절하게 사용하게 되면 더 명료한 코드가 된다. 연산에 적절한 이름을 지어 주고 도우미 메서드를 적정히 활용하는 것은 일반 반복코드보다 스트림 파이프라인에서 훨씬 크다
**스트림을 처음 쓰기 시작하면 모든 반복문을 스트림으로 바꾸고 싶을 수 있다. 그러나 바꿀 수 있더라도 가독성과 유지보수 측면을 잘고려해야 한다. 스트림과 반복문을 적절히 활용하는 것이 제일 최선이다**
## 코드 블럭 vs 람다
코드 블럭과 람다 중 어느 것을 사용해야 할까? 람다가 코드 블럭보다 간결하고 가독성이 좋다. 하지만 람다는 코드 블럭과 달리 this 키워드를 사용할 수 없다. 또한 람다는 return, break, continue 문을 사용할 수 없다. 따라서 코드 블럭을 사용해야 하는 경우가 있다.
추가적으로 코드 블럭에서는 메서드 선에 명시된 예외를 던질 수 있지만 람다에서는 불가능하다.
## 스트림이 적합한 경우
- 원소들의 시퀀스를 일관되게 변환한다.
- 원소들의 시퀀스를 필터링한다.
- 원소들의 시퀀스를 하나의 연산을 사용해 결합한다.(예: 모든 원소를 하나의 리스트로 만든다.)
- 원소들의 시퀀스를 컬렉션에 모은다.
- 원소들의 시퀀스에서 특정 조건을 만족하는 원소를 찾는다.
## 스트림이 적합하지 않은 경우
- 데이터가 파이프 라인의 여러 단계를 통과할 때 이 데이터의 각 단계에서의 값들에 동시에 접근하기 어려운 경우
- 스트림 파이프라인은 한 값을 다른 값에 매핑하고 나면 원래의 값을 잃은 구조이기 때문이다.
## 핵심 정리
스트림을 사용해야 코드가 더 간결해질 경우가 있고 반복 방식이 더 간결할 경우가 있다. 어느 쪽을 선택하는 규칙은 없지만 참고할 만한 지침 정도는 있다 어느 쪽이 더 나은지 알고 싶다면 둘 다 작성해보고 더 나은 코드를 선택하자